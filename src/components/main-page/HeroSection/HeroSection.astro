---
import Typography from '@/components/shared/ui/Typography/Typography.astro';
import Button from '@/components/shared/ui/Button/Button.astro';
import UnderlineIcon3 from '@/assets/icons/strokes/underline-3.svg';
import RealHandwritten from '@/assets/icons/real-handwritten.svg';
import styles from './HeroSection.module.scss';
import { URLS } from '@/constants.ts';

const { src: underlineIcon3Src } = UnderlineIcon3;
---

<section class={styles.hero}>
  <div class={styles.hero__title}>
    <Typography variant="h1" style={`--underline-icon-url: url(${underlineIcon3Src})`}
      >MEET IN <span class={styles['hero__title-extra']} data-animate-text aria-label="REAL">
        <RealHandwritten class={styles['hero__title-svg']} />
      </span> LIFE
    </Typography>
  </div>

  <div class={styles.hero__text}>
    <Typography variant="body3">True friends meet up â€“ not just react to stories</Typography>
  </div>

  <div class={styles.hero__btn}>
    <Button href={URLS.download} variant="contained" size="large">Download</Button>
  </div>

  <div class={styles['hero__extra-text']}>
    <Typography variant="extra">Android coming soon</Typography>
  </div>
</section>

<script>
  // SVG handwriting animation
  const initAnimation = () => {
    const animatedTextElement = document.querySelector('[data-animate-text]');

    if (!animatedTextElement) {
      return;
    }

    const observerCallback = (entries: IntersectionObserverEntry[]) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const targetElement = entry.target as HTMLElement;
          // Set data attribute to trigger CSS animation
          targetElement.setAttribute('data-animated', 'true');
          // Unobserve after animation triggers
          observer.unobserve(targetElement);
        }
      });
    };

    const observerOptions: IntersectionObserverInit = {
      root: null,
      rootMargin: '0px',
      threshold: 0.5, // Trigger when 50% of element is visible
    };

    const observer = new IntersectionObserver(observerCallback, observerOptions);
    observer.observe(animatedTextElement);
  };

  // Initialize on DOM ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initAnimation);
  } else {
    initAnimation();
  }
</script>
